# 実装計画

## タスク概要

本実装計画は、`apply_labels`パラメータの完全削除、複雑度機能のデフォルトOFF化、複雑度閾値の緩和を段階的に実施します。各タスクは1-3時間で完了可能なサイズに分割され、テスト駆動開発(TDD)のアプローチに従います。

## 実装タスク

- [ ] 1. 入力パラメータ定義の修正
- [ ] 1.1 action.ymlから冗長なパラメータを削除し、デフォルト値を更新
  - GitHub Actions入力定義から`apply_labels`パラメータ定義を完全に削除
  - `complexity_enabled`パラメータのデフォルト値を`"false"`に変更
  - `complexity_thresholds`パラメータのデフォルト値を`'{"medium": 15, "high": 30}'`に変更
  - 変更後の定義ファイルの構文を検証
  - _要件: 1.1, 2.2, 3.1_

- [ ] 2. 型定義の修正
- [ ] 2.1 Config型定義から削除されたパラメータを除外
  - `Config`インターフェースから`applyLabels: boolean`プロパティを削除
  - `ActionInputs`型から`apply_labels`プロパティを削除(型定義の一貫性維持)
  - TypeScript型チェックがエラーなく通ることを確認
  - _要件: 1.2_

- [ ] 3. 入力マッピングロジックの修正
- [ ] 3.1 入力パース処理から削除されたパラメータの読み込みを除外
  - `mapActionInputsToConfig`関数から`apply_labels`読み込み処理を削除
  - `applyLabels: parseBoolean(inputs.apply_labels)`の行を削除
  - 複雑度のデフォルト値はaction.ymlに委任されることを確認
  - 型チェックとlintがエラーなく通ることを確認
  - _要件: 1.3_

- [ ] 4. Actions I/O層の修正
- [ ] 4.1 入力取得処理から削除されたパラメータを除外し、デフォルト値を更新
  - `getActionInputs`関数から`apply_labels`入力取得処理を削除
  - `complexity_thresholds`のフォールバックデフォルト値を`'{"medium": 15, "high": 30}'`に変更
  - 入力取得ロジックが正しく動作することを確認
  - _要件: 1.6, 3.1_

- [ ] 5. メインフローの修正
- [ ] 5.1 ラベル適用の制御ロジックから削除されたパラメータのチェックを除外
  - `config.applyLabels`による条件分岐を削除
  - ラベル適用処理が個別`*_enabled`フラグのみで制御されることを確認
  - Label Decision EngineとLabel Applicatorが既に個別フラグを参照していることを確認
  - メインフローが正常に動作することを検証
  - _要件: 1.5, 6.5_

- [ ] 6. テストコードの更新(Input Mapper)
- [ ] 6.1 削除されたパラメータに関連するテストを除外
  - `__tests__/input-mapper.test.ts`から`apply_labels`関連テストケースを完全に削除
  - `describe('apply_labels parameter', ...)`ブロック全体を削除
  - 削除後もテストが正常に実行されることを確認
  - _要件: 4.1_

- [ ] 6.2 新しいデフォルト値を検証するテストを追加
  - `complexity_enabled`のデフォルト値が`false`であることを検証するテストケースを追加
  - `complexity_thresholds`のデフォルト値が`{"medium": 15, "high": 30}`であることを検証するテストケースを追加
  - 入力未指定時に新しいデフォルト値が適用されることを確認
  - 明示的に値を指定した場合に指定値が優先されることを確認
  - _要件: 4.3, 4.4_

- [ ] 7. テストコードの更新(Label Applicator)
- [ ] 7.1 削除されたパラメータへの依存を除外し、個別制御フラグでの動作を検証
  - `__tests__/label-applicator.test.ts`から`applyLabels`パラメータへの参照を削除
  - 個別`*_enabled`フラグを使用するテストケースに更新
  - 各ラベル種別が独立して有効/無効を制御できることを検証
  - テストカバレッジが維持されることを確認
  - _要件: 4.2, 6.1-6.4_

- [ ] 8. テストコードの更新(統合テスト)
- [ ] 8.1 メインフローの統合テストを更新
  - `__tests__/index.test.ts`と`__tests__/integration.test.ts`を更新
  - `config.applyLabels`チェックを削除したフローが正常に動作することを検証
  - 複雑度機能がデフォルトOFFの状態で統合テストが成功することを確認
  - 個別`*_enabled`フラグでラベル制御が機能することを検証
  - _要件: 6.6_

- [ ] 9. ドキュメントの更新
- [ ] 9.1 README.mdから削除されたパラメータの記載を除外
  - `apply_labels`パラメータに関する記載をすべて削除
  - 個別`*_enabled`パラメータの使用方法を明確に記載
  - 複雑度機能がオプション機能でありデフォルトOFFであることを記載
  - クイックスタートセクションを更新し、基本的な使用例を提供
  - _要件: 5.1, 5.2, 5.3_

- [ ] 9.2 docs/configuration.mdのパラメータ一覧を更新
  - 入力パラメータテーブルから`apply_labels`を削除
  - `complexity_enabled`のデフォルト値を`"false"`に更新
  - `complexity_thresholds`のデフォルト値を`'{"medium": 15, "high": 30}'`に更新
  - 個別制御パラメータの説明を明確化
  - _要件: 5.4, 5.5_

- [ ] 9.3 CHANGELOG.mdに破壊的変更を記録
  - `apply_labels`パラメータの削除を破壊的変更として記録
  - `complexity_enabled`デフォルト値変更(`"true"` → `"false"`)を記録
  - `complexity_thresholds`デフォルト値変更を記録
  - 移行ガイドを記載(個別`*_enabled`フラグの使用方法)
  - _要件: 5.6, 5.7_

- [ ] 10. 品質チェックと統合検証
- [ ] 10.1 全品質チェックを実行し、すべてが成功することを確認
  - `pnpm lint`を実行し、ESLintエラーが0件であることを確認
  - `pnpm type-check`を実行し、TypeScriptエラーが0件であることを確認
  - `pnpm test`を実行し、すべてのテストが成功することを確認
  - テストカバレッジが93%以上を維持していることを確認
  - `pnpm build`を実行し、ビルドが成功することを確認
  - _要件: 6.6, 非機能要件(パフォーマンスと品質)_

## 実装完了条件

以下のすべての条件を満たすことで、実装が完了したと判断します:

- [ ] すべてのタスクが完了としてマークされている
- [ ] `pnpm lint && pnpm type-check && pnpm test && pnpm build`がすべて成功
- [ ] テストカバレッジが93%以上を維持
- [ ] `apply_labels`パラメータの痕跡がコードベースから完全に削除されている
- [ ] 複雑度機能がデフォルトOFFで動作することを確認
- [ ] 新しい複雑度閾値が適用されることを確認
- [ ] すべてのドキュメントが更新されている

## 実装時の注意事項

- **TDDアプローチ**: 各タスクでは、まずテストを修正/追加してから実装を修正すること
- **段階的コミット**: 各主要タスク(1, 2, 3...)完了後にコミットを作成すること
- **型安全性**: TypeScript strict modeに準拠し、`any`型を使用しないこと
- **エラーハンドリング**: neverthrow `Result`型を使用した既存のエラーハンドリングパターンを維持すること
- **コード品質**: ESLintとPrettierのルールに準拠すること
