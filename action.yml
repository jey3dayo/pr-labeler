name: "PR Labeler"
description: "Intelligent PR labeling with file size checks, automatic categorization, and risk assessment"
author: "jey3dayo"
branding:
  icon: "file-text"
  color: "purple"

inputs:
  # 基本制限
  file_size_limit:
    description: "Maximum file size (e.g., 100KB, 1.5MB, 500000)"
    required: false
    default: "100KB"

  file_lines_limit:
    description: "Maximum lines per file (current file total lines, not diff additions)"
    required: false
    default: "500"

  pr_additions_limit:
    description: "Maximum added lines for entire PR (diff-based)"
    required: false
    default: "5000"

  pr_files_limit:
    description: "Maximum number of files in PR (excluding removed files)"
    required: false
    default: "50"

  # ラベル設定
  auto_remove_labels:
    description: "Remove labels when limits are no longer exceeded"
    required: false
    default: "true"

  # PR Labeler - ラベル種別の選択的有効化
  size_enabled:
    description: "Enable size labels (size/small, size/medium, size/large, size/xlarge, size/xxlarge)"
    required: false
    default: "true"

  size_thresholds:
    description: "JSON string for size label thresholds (additions-based)"
    required: false
    default: '{"small": 200, "medium": 500, "large": 1000, "xlarge": 3000}'

  complexity_enabled:
    description: "Enable complexity labels (complexity/medium, complexity/high)"
    required: false
    default: "false"

  complexity_thresholds:
    description: "JSON string for complexity label thresholds"
    required: false
    default: '{"medium": 15, "high": 30}'

  category_enabled:
    description: "Enable category labels (category/tests, category/docs, etc.)"
    required: false
    default: "true"

  risk_enabled:
    description: "Enable risk labels (risk/high, risk/medium)"
    required: false
    default: "true"

  large_files_label:
    description: "Label for files exceeding size or line limits"
    required: false
    default: "auto/large-files"

  too_many_files_label:
    description: "Label for PRs with too many files"
    required: false
    default: "auto/too-many-files"

  too_many_lines_label:
    description: "Label for files exceeding line count limits"
    required: false
    default: "auto:too-many-lines"

  excessive_changes_label:
    description: "Label for PRs with excessive changes (total additions)"
    required: false
    default: "auto:excessive-changes"

  # 動作設定
  skip_draft_pr:
    description: "Skip check for draft PRs"
    required: false
    default: "true"

  comment_on_pr:
    description: "Comment on PR (auto/always/never)"
    required: false
    default: "auto"

  # Label-Based Workflow Failure Control
  fail_on_large_files:
    description: "Fail workflow if large files are detected (labeled with large_files_label or too_many_lines_label)"
    required: false
    default: ""

  fail_on_too_many_files:
    description: "Fail workflow if too many files are detected (labeled with too_many_files_label)"
    required: false
    default: ""

  fail_on_pr_size:
    description: "Fail workflow if PR size exceeds threshold (values: '', 'small', 'medium', 'large', 'xlarge', 'xxlarge'). Empty string to disable."
    required: false
    default: ""

  enable_summary:
    description: "Write PR metrics to GitHub Actions Summary"
    required: false
    default: "true"

  # 除外パターン
  additional_exclude_patterns:
    description: "Additional file patterns to exclude (comma or newline separated)"
    required: false
    default: ""

  # Directory-Based Labeling
  enable_directory_labeling:
    description: "Enable Directory-Based Labeling feature"
    required: false
    default: "false"
  directory_labeler_config_path:
    description: "Path to directory labeler configuration file"
    required: false
    default: ".github/directory-labeler.yml"
  max_labels:
    description: "Maximum number of labels to apply (0 for unlimited)"
    required: false
    default: "10"
  use_default_excludes:
    description: "Use default exclude patterns (node_modules, dist, etc.)"
    required: false
    default: "true"

  # 多言語対応
  language:
    description: "Language for output messages (en, ja, en-US, ja-JP)"
    required: false

  # 認証
  github_token:
    description: "GitHub token for API access (required). Provide explicitly or ensure GITHUB_TOKEN/GH_TOKEN environment variable is set"
    required: true

outputs:
  large_files:
    description: "JSON array of files exceeding size or line limits with violation details"
  pr_additions:
    description: "Total lines added in PR (diff-based)"
  pr_files:
    description: "Total number of files in PR (excluding removed files)"
  exceeds_file_size:
    description: 'Whether any file exceeds size limit ("true" | "false")'
  exceeds_file_lines:
    description: 'Whether any file exceeds line limit ("true" | "false")'
  exceeds_additions:
    description: 'Whether PR exceeds total additions limit ("true" | "false")'
  exceeds_file_count:
    description: 'Whether PR exceeds file count limit ("true" | "false")'
  has_violations:
    description: 'Whether any violation exists ("true" | "false")'

runs:
  using: "node20"
  main: "dist/index.js"
