---
description: 指定されたファイルをレビューし、所見を docs/_<feature>_<part>.md に保存する
allowed-tools: Bash, Read, Write, Glob
argument-hint: "<feature-slug> <part-label> <file-path> [追加のファイルパス...]"
---

# Review & Persist Feedback

提供されたファイルパスをレビューし、結果を `docs/_<feature-slug>_<part-label>.md` に保存する。思考は英語で行い、出力は日本語とする。

## 1. 引数の解釈

- `$1` に `feature-slug`（例: `actions-summary-output`）を受け取る。スペースを含む場合はハイフンで結合する。
- `$2` にレビュー回/区分を表す `part-label`（例: `part1` や `draft`）を受け取る。
- `$3` 以降にレビュー対象のファイルパスを列挙する。相対パスを想定し、最低1件は必須。
- `feature-slug` と `part-label` の英数字・ハイフン・アンダースコア以外の文字は削除し、小文字化する。

## 2. 保存先パスの決定

- 出力ファイルパスを `docs/_${feature-slug}_${part-label}.md` とする。
- 既存ファイルが存在する場合は追記する。存在しない場合は新規作成。
- 追記時はセクション見出しに ISO8601 形式（例: `2024-05-22T14:30:00+09:00`）のタイムスタンプを含め、過去のログを維持する。

## 3. レビュー準備

1. すべてのファイルパスが実在するか確認する。存在しない場合はコマンド実行を中断し、エラーを出力する。
2. 必要に応じて `Read` または `Bash` (`cat`, `sed`, `rg` など) を使って対象ファイルの内容を取得する。
3. 依存関係や関連ファイルが必要であれば追加で参照する。

## 4. レビュー方針

- コードレビューとして重大度順（Must Fix > Should Fix > Nice to Have）に指摘を列挙する。
- 各指摘には以下を含める:
  - 対象ファイルと行番号（例: `src/index.ts:42`）
  - 問題点の説明（理由と影響を明確に）
  - 修正提案や具体的な代替案がある場合は合わせて記載
- 指摘がない場合でも「指摘事項なし」と明記し、潜在的なリスクや追加確認事項があれば触れる。
- 必要に応じてテスト観点や再現手順、確認すべきシナリオを記載する。
- 自動テストが不足している、もしくは影響範囲が広いと判断した場合は、その理由と推奨する検証手段を具体的に示す。

## 5. ドキュメント構成

保存する Markdown ファイルには以下の構造で追記または作成する。

```markdown
# レビュー記録: <feature-slug>

## <part-label> / <timestamp>
- 実行コマンド: `/review-feedback <arguments>`
- 対象ファイル:
  - path/to/file.ts
  - another/file.ts

### 指摘事項
#### Must Fix
- `src/example.ts:42` - 内容

#### Should Fix
- （必要に応じて）

#### Nice to Have
- （必要に応じて）

### 確認事項・質問
- 必要であれば記載

### 推奨テスト
- 実施すべき検証やテストがあれば記載

### 所感・メモ
- 補足情報やフォローアップの必要性を記載
```

- 該当セクションが空の場合は「なし」と明記する。
- 既存ファイルに追記する際は、重複した見出しを避け、タイムスタンプ付きのサブセクションを追加する。

## 6. 出力

- レビュー完了後、保存したファイルパスと主要な指摘概要をコンソールに表示する。
- 重大な問題（Must Fix）がある場合は明確に強調する。

## 7. 注意事項

- 既存のレビュー内容は削除しない。
- Markdown は ASCII のみを使用し、日本語テキストは UTF-8 で出力する。
- コマンド実行の最終メッセージでは、レビュー結果のサマリと次のアクション（必要であれば）を簡潔に伝える。
