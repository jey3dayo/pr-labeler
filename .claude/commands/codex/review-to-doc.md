---
description: Review file(s) and generate docs/_<feature>_partN.md with structured summary
allowed-tools: Read, Grep, Glob, Write, Bash
argument-hint: <file|glob> [--name <feature>] [--part N] [--out docs]
---

# File Review → Doc

**目的**: 指定ファイルをレビューし、結果を `docs/_<機能名>_part<番号>.md` に生成します。

## 入力

- 必須: 対象ファイルまたはグロブパターン（例: `src/**/*.ts`）
- 任意フラグ:
  - `--name <feature>`: 機能名を明示指定（未指定時は推定）
  - `--part <N>`: パート番号（デフォルト: `1`）
  - `--out <dir>`: 出力ディレクトリ（デフォルト: `docs`）

## 前提チェックと準備

1. 入力ファイルを解決（グロブ可）。1件以上存在しない場合は中断し、使い方を表示。
2. 機能名の決定ロジック（上から順に採用）:
   - `--name` 指定があればそれを採用
   - 最初の対象ファイルの先頭見出し(`# ...`) から推定（日本語可）
   - それが無ければ最初の対象ファイルのベース名（拡張子除去）
   - ファイル名に使えない記号は`-`に置換。Unicodeは許容
3. パート番号は `--part` 指定があればそれを使用、無ければ `1`
4. 出力ディレクトリは `--out` 指定があればそれを使用、無ければ `docs`

## レビュー実施方針（要約にフォーカス）

レビューは「重要論点に絞る・可読な要約」を原則とし、以下の観点で最大でも各3点までに収める：

- 設計整合性: 既存アーキテクチャ/責務分離/依存方向
- 型安全性: 明示的型、例外・入力検証、`any`回避
- 複雑度/保守性: 関数サイズ、分岐、命名、一貫性
- リスク/欠落: エラーハンドリング、I/O、境界条件、パフォーマンス

## ドキュメント生成規約

- ファイル名: `_<機能名>_part<番号>.md`（例: `docs/_ラベラー_part1.md`）
- 出力先: 既定で `docs/`（存在しなければ作成）
- 既存ファイルがある場合: `_v2` など連番を末尾に付与して衝突回避
- コンテンツ: `docs/documentation-guidelines.md` のメタデータ形式に準拠（日本語本文）

## 出力テンプレート

以下のテンプレートでファイルを生成する。`$FEATURE`, `$PART`, `$DATE`, `$FILES` を置換し、セクションは簡潔に（各3〜6行目安）。

```
# 📝 レビューサマリ — $FEATURE (Part $PART)

**最終更新**: $DATE
**対象**: 開発者・メンテナー
**タグ**: `category/documentation`, `audience/developer`

## 対象ファイル

$FILES

## 概要

対象の目的・役割・変更点を簡潔に要約。

## 主要論点（重要度順、最大3件）

1. 論点: 説明と影響範囲
2. 論点: 説明と影響範囲
3. 論点: 説明と影響範囲（必要時）

## 改善提案（実行可能な次アクション）

- 提案: 具体的手順や意図（必要なら簡易コード例）
- 提案: テスト観点/検証方法
- 提案: リスク低減策や段階的導入

## 既知のリスク/未解決事項

- リスク: 内容と発生条件、回避策
- 未解決: 調査が必要な点、意思決定待ち

## 参考

- 関連PR/Issue/設計資料（あれば）
```

## 実行手順（エージェント向け）

1. 入力解決: 引数のファイル/グロブを展開して既存ファイル群を列挙
2. 機能名の決定: `--name` → 見出し → ベース名 の順で採用
3. レビュー: 上記観点で要点を抽出し、出力テンプレートへ反映
4. 出力準備: `docs/`（または `--out`）を作成（無ければ）
5. ファイル名生成: `_<機能名>_part<番号>.md`。衝突時は `_v2` などを末尾追加
6. 書き込み: テンプレートを埋めてファイル生成
7. 結果表示: 生成ファイルのパス（相対）と次アクションを出力

## 出力例（完了時の表示）

```
Created: docs/_レビュー対象_part1.md
Next: 追加のファイルがあれば `/codex:review-to-doc src/new-file.ts --name レビュー対象 --part 2`
```

## 注意事項

- 本コマンドはレビュー観点の「要約」を生成する。詳細な設計レビューは `/kiro:validate-design` を利用
- ドキュメントの命名規約（kebab-case英語）と衝突する場合でも、明示意図として本形式（日本語名+`partN`）を優先
- 生成したドキュメントは PR に含め、`docs/documentation-guidelines.md` のメタデータを満たすこと
